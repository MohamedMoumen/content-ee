(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"15Lz":function(e,i,t){"use strict";t.r(i),t.d(i,"AppViewerModule",(function(){return L}));var o=t("An66"),n=t("1VvW"),s=t("yWDA"),r=t("BsNf"),a=t("rmkp"),c=t("cutI"),d=t("e7Tg"),l=t("7bav"),h=t("D57K"),p=t("knli"),v=t("sdze"),f=t("qYF+"),u=t("ZTXN"),g=t("GoAz"),w=t("kuMc"),y=t("mWib"),m=t("DyCy"),b=t("kZht"),N=t("ofez"),A=t("UtD2"),S=t("v0f2"),I=t("aLmO"),P=t("SNg3");function O(e,i){if(1&e&&(b.Bc(0,"adf-viewer-sidebar"),b.wc(1,"aca-info-drawer",5),b.Ac()),2&e){const e=b.Nc(2);b.hc(1),b.Uc("node",e.selection.file)}}function T(e,i){if(1&e&&(b.zc(0),b.wc(1,"app-toolbar-menu-item",6),b.yc()),2&e){const e=i.$implicit;b.hc(1),b.Uc("actionRef",e)}}function k(e,i){if(1&e&&(b.Bc(0,"adf-viewer-open-with"),b.pd(1,T,2,1,"ng-container",2),b.Ac()),2&e){const e=b.Nc(2);b.hc(1),b.Uc("ngForOf",e.openWith)("ngForTrackBy",e.trackByActionId)}}function D(e,i){if(1&e&&(b.zc(0),b.wc(1,"aca-toolbar-action",6),b.yc()),2&e){const e=i.$implicit;b.hc(1),b.Uc("actionRef",e)}}function E(e,i){if(1&e&&b.wc(0,"alfresco-enterprise-viewer",5),2&e){const e=b.Nc(2);b.Uc("node",e.node)}}const F=function(e){return{"right_side--hide":e}},x=function(){return["*"]};function C(e,i){if(1&e){const e=b.Cc();b.zc(0),b.Bc(1,"adf-viewer",1),b.Jc("showViewerChange",(function(){return b.hd(e),b.Nc().onViewerVisibilityChanged()}))("navigateBefore",(function(i){return b.hd(e),b.Nc().onNavigateBefore(i)}))("navigateNext",(function(i){return b.hd(e),b.Nc().onNavigateNext(i)})),b.Oc(2,"adfAppConfig"),b.pd(3,O,2,1,"adf-viewer-sidebar",0),b.Oc(4,"async"),b.pd(5,k,2,2,"adf-viewer-open-with",0),b.Bc(6,"adf-viewer-toolbar-actions"),b.pd(7,D,2,1,"ng-container",2),b.Ac(),b.Bc(8,"adf-viewer-extension",3,4),b.pd(10,E,1,1,"ng-template"),b.Ac(),b.Ac(),b.yc()}if(2&e){const e=b.Nc();b.hc(1),b.Uc("ngClass",b.Zc(23,F,!e.showRightSide))("fileName",e.fileName)("maxRetries",b.Pc(2,19,"viewer.maxRetries"))("nodeId",e.nodeId)("versionId",e.versionId)("allowNavigate",e.navigateMultiple)("allowRightSidebar",!0)("allowPrint",!1)("showRightSidebar",!0)("allowDownload",!1)("allowFullScreen",!1)("overlayMode",!0)("canNavigateBefore",!!e.previousNodeId)("canNavigateNext",!!e.nextNodeId),b.hc(2),b.Uc("ngIf",b.Pc(4,21,e.infoDrawerOpened$)),b.hc(2),b.Uc("ngIf",e.openWith.length),b.hc(2),b.Uc("ngForOf",e.toolbarActions)("ngForTrackBy",e.trackByActionId),b.hc(1),b.Uc("supportedExtensions",b.Yc(25,x))}}const Y=[{path:"",data:{title:"APP.PREVIEW.TITLE",navigateMultiple:!0},component:(()=>{class e{constructor(e,i,t,o,n,s,r,a,c,d){this.router=e,this.route=i,this.store=t,this.extensions=o,this.contentApi=n,this.actions$=s,this.preferences=r,this.apiService=a,this.uploadService=c,this.appHookService=d,this.onDestroy$=new u.a,this.folderId=null,this.nodeId=null,this.versionId=null,this.showRightSide=!1,this.openWith=[],this.toolbarActions=[],this.navigateSource=null,this.navigateMultiple=!0,this.routesSkipNavigation=["shared","recent-files","favorites"],this.navigationSources=["favorites","libraries","personal-files","recent-files","shared"],this.recentFileFilters=['TYPE:"content"','-PNAME:"0/wiki"','-TYPE:"app:filelink"','-TYPE:"fm:post"','-TYPE:"cm:thumbnail"','-TYPE:"cm:failedThumbnail"','-TYPE:"cm:rating"','-TYPE:"dl:dataList"','-TYPE:"dl:todoList"','-TYPE:"dl:issue"','-TYPE:"dl:contact"','-TYPE:"dl:eventAgenda"','-TYPE:"dl:event"','-TYPE:"dl:task"','-TYPE:"dl:simpletask"','-TYPE:"dl:meetingAgenda"','-TYPE:"dl:location"','-TYPE:"fm:topic"','-TYPE:"fm:post"','-TYPE:"ia:calendarEvent"','-TYPE:"lnk:link"'],this.containersSkipNavigation=["adf-viewer__sidebar","cdk-overlay-container","adf-image-viewer"]}get versionsApi(){var e;return this._versionsApi=null!==(e=this._versionsApi)&&void 0!==e?e:new f.a(this.apiService.getInstance()),this._versionsApi}ngOnInit(){if(this.infoDrawerOpened$=this.store.select(v.isInfoDrawerOpened),Object(g.a)(this.infoDrawerOpened$).pipe(Object(w.a)(this.onDestroy$)).subscribe(e=>{this.showRightSide=e}),this.store.select(v.getAppSelection).pipe(Object(w.a)(this.onDestroy$)).subscribe(e=>{this.selection=e}),this.extensions.getViewerToolbarActions().pipe(Object(w.a)(this.onDestroy$)).subscribe(e=>{this.toolbarActions=e.filter(e=>"app.viewer.fullscreen"===e.id||"app.viewer.separator.1"===e.id||"app.viewer.share"===e.id)}),this.extensions.getOpenWithActions().pipe(Object(w.a)(this.onDestroy$)).subscribe(e=>{this.openWith=e}),this.route.params.subscribe(e=>{this.folderId=e.folderId;const{nodeId:i}=e;this.versionId=e.versionId,this.versionId&&this.versionsApi.getVersion(i,this.versionId).then(e=>{e&&this.store.dispatch(new v.SetCurrentNodeVersionAction(e))}),i&&this.displayNode(i)}),this.route.queryParams.subscribe(e=>{this.navigationPath=e.path||e.location}),this.route.snapshot.data&&this.route.snapshot.data.navigateSource){const e=this.route.snapshot.data.navigateSource.toLowerCase();this.navigationSources.includes(e)&&(this.navigateSource=this.route.snapshot.data.navigateSource)}this.actions$.pipe(Object(m.e)(v.ViewerActionTypes.ClosePreview),Object(w.a)(this.onDestroy$)).subscribe(()=>{this.store.dispatch(new v.SetCurrentNodeVersionAction(null)),this.navigateToFileLocation()}),this.actions$.pipe(Object(m.e)(v.ViewerActionTypes.RefreshPreview),Object(w.a)(this.onDestroy$)).subscribe(e=>{var i,t;this.displayNode(null===(t=null===(i=null==e?void 0:e.payload)||void 0===i?void 0:i.entry)||void 0===t?void 0:t.id)}),this.appHookService.nodesDeleted.pipe(Object(w.a)(this.onDestroy$)).subscribe(()=>this.navigateToFileLocation()),this.uploadService.fileUploadDeleted.pipe(Object(w.a)(this.onDestroy$)).subscribe(()=>this.navigateToFileLocation()),this.uploadService.fileUploadComplete.pipe(Object(y.a)(300),Object(w.a)(this.onDestroy$)).subscribe(e=>{this.apiService.nodeUpdated.next(e.data.entry),this.displayNode(e.data.entry.id)}),this.previewLocation=this.router.url.substr(0,this.router.url.indexOf("/",1)).replace(/\//g,"")}onViewerVisibilityChanged(){this.store.dispatch(new v.ReloadDocumentListAction),this.navigateToFileLocation()}ngOnDestroy(){this.store.dispatch(new v.SetCurrentNodeVersionAction(null)),this.onDestroy$.next(!0),this.onDestroy$.complete()}trackByActionId(e,i){return i.id}displayNode(e){var i,t,o,n;return Object(h.a)(this,void 0,void 0,(function*(){if(e)try{if(this.node=yield this.contentApi.getNodeInfo(e).toPromise(),this.store.dispatch(new v.SetSelectedNodesAction([{entry:this.node}])),this.navigateMultiple=this.extensions.canShowViewerNavigation({entry:this.node}),!this.navigateMultiple)return this.nodeId=this.node.id,void(this.fileName=this.node.name+(null===(t=null===(i=this.node)||void 0===i?void 0:i.properties)||void 0===t?void 0:t["cm:versionLabel"]));if(this.node&&this.node.isFile){const e=yield this.getNearestNodes(this.node.id,this.node.parentId);return this.nodeId=this.node.id,this.previousNodeId=e.left,this.nextNodeId=e.right,void(this.fileName=this.node.name+(null===(n=null===(o=this.node)||void 0===o?void 0:o.properties)||void 0===n?void 0:n["cm:versionLabel"]))}}catch(s){401!==JSON.parse(s.message).error.statusCode&&this.router.navigate([this.previewLocation,{outlets:{viewer:null}}]).then(()=>{this.router.navigate([this.previewLocation,e])})}}))}onNavigateBefore(e){if("click"!==e.type&&this.shouldNavigate(e.target))return;const i=this.getFileLocation();this.store.dispatch(new v.ViewNodeAction(this.previousNodeId,{location:i}))}onNavigateNext(e){if("click"!==e.type&&this.shouldNavigate(e.target))return;const i=this.getFileLocation();this.store.dispatch(new v.ViewNodeAction(this.nextNodeId,{location:i}))}getNearestNodes(e,i){return Object(h.a)(this,void 0,void 0,(function*(){const t={left:null,right:null};if(!e||!i)return t;try{const o=yield this.getFileIds(this.navigateSource,i),n=o.indexOf(e);return n>=0?{left:o[n-1]||null,right:o[n+1]||null}:t}catch(o){return t}}))}getFileIds(e,i){return Object(h.a)(this,void 0,void 0,(function*(){if(("personal-files"===e||"libraries"===e)&&i){const e=this.preferences.get("personal-files.sorting.key")||"modifiedAt",t=this.preferences.get("personal-files.sorting.direction")||"desc",o=(yield this.contentApi.getNodeChildren(i,{fields:["id",this.getRootField(e)],where:"(isFile=true)"}).toPromise()).list.entries.map(e=>e.entry);return this.sort(o,e,t),o.map(e=>e.id)}if("favorites"===e){const e=yield this.contentApi.getFavorites("-me-",{where:"(EXISTS(target/file))",fields:["target"]}).toPromise(),i=this.preferences.get("favorites.sorting.key")||"modifiedAt",t=this.preferences.get("favorites.sorting.direction")||"desc",o=e.list.entries.map(e=>e.entry.target.file);return this.sort(o,i,t),o.map(e=>e.id)}if("shared"===e){const e=this.preferences.get("shared.sorting.key")||"modifiedAt",i=this.preferences.get("shared.sorting.direction")||"desc",t=(yield this.contentApi.findSharedLinks({fields:["nodeId",this.getRootField(e)]}).toPromise()).list.entries.map(e=>e.entry);return this.sort(t,e,i),t.map(e=>e.nodeId)}if("recent-files"===e){const e=(yield this.contentApi.getPerson("-me-").toPromise()).entry.id,i=this.preferences.get("recent-files.sorting.key")||"modifiedAt",t=this.preferences.get("recent-files.sorting.direction")||"desc",o={query:{query:"*",language:"afts"},filterQueries:[{query:"cm:modified:[NOW/DAY-30DAYS TO NOW/DAY+1DAY]"},{query:`cm:modifier:${e} OR cm:creator:${e}`},{query:this.recentFileFilters.join(" AND ")}],fields:["id",this.getRootField(i)],include:["path","properties","allowableOperations"],sort:[{type:"FIELD",field:"cm:modified",ascending:!1}]},n=(yield this.contentApi.search(o).toPromise()).list.entries.map(e=>e.entry);return this.sort(n,i,t),n.map(e=>e.id)}return[]}))}getRootField(e){return e?e.split(".")[0]:e}handleKeyboardEvent(e){const i=e.keyCode;39!==i&&37!==i||(e.preventDefault(),e.stopImmediatePropagation())}sort(e,i,t){const o={};(i.includes("sizeInBytes")||"name"===i)&&(o.numeric=!0),e.sort((e,n)=>{let r=s.kc.getValue(e,i);r=r?r instanceof Date?r.valueOf().toString():r.toString():"";let a=s.kc.getValue(n,i);return a=a?a instanceof Date?a.valueOf().toString():a.toString():"","asc"===t?r.localeCompare(a,void 0,o):a.localeCompare(r,void 0,o)})}navigateToFileLocation(){const e=this.getFileLocation();this.router.navigateByUrl(e)}getFileLocation(){return this.navigationPath||this.router.parseUrl(this.router.url).root.children[n.i].toString()}shouldNavigate(e){let i=e.parentElement;for(;i&&!this.isChild(i.classList);)i=i.parentElement;return!!i}isChild(e){return Array.from(e).some(e=>this.containersSkipNavigation.includes(e))}}return e.\u0275fac=function(i){return new(i||e)(b.vc(n.m),b.vc(n.a),b.vc(N.h),b.vc(p.AppExtensionService),b.vc(p.ContentApiService),b.vc(m.a),b.vc(s.Wc),b.vc(s.c),b.vc(s.Sc),b.vc(p.AppHookService))},e.\u0275cmp=b.pc({type:e,selectors:[["app-viewer"]],hostAttrs:[1,"app-viewer"],hostBindings:function(e,i){1&e&&b.Jc("keydown",(function(e){return i.handleKeyboardEvent(e)}),!1,b.fd)},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngClass","fileName","maxRetries","nodeId","versionId","allowNavigate","allowRightSidebar","allowPrint","showRightSidebar","allowDownload","allowFullScreen","overlayMode","canNavigateBefore","canNavigateNext","showViewerChange","navigateBefore","navigateNext"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"supportedExtensions"],["extension",""],[3,"node"],[3,"actionRef"]],template:function(e,i){1&e&&b.pd(0,C,11,26,"ng-container",0),2&e&&b.Uc("ngIf",i.nodeId)},directives:[o.o,s.bd,o.m,s.fd,o.n,s.cd,s.ed,A.a,s.dd,S.a,I.a,P.a],pipes:[s.f,o.b],styles:[".app-viewer{width:100%;height:100%}.app-viewer .adf-viewer-toolbar .adf-toolbar-divider{display:none}.app-viewer .adf-viewer-toolbar-actions{display:flex;flex-direction:row;align-items:center}.app-viewer .adf-viewer-toolbar-actions .adf-toolbar-divider{display:inline}.app-viewer .adf-viewer-toolbar .mat-toolbar>button:last-child{display:none}.app-viewer .adf-viewer.right_side--hide .adf-viewer__sidebar__right{width:0}.app-viewer .adf-viewer .adf-viewer-content-container,.app-viewer .adf-viewer .adf-viewer-content-container adf-preview-extension{width:100%}"],encapsulation:2}),e})()}];let L=(()=>{class e{}return e.\u0275mod=b.tc({type:e}),e.\u0275inj=b.sc({factory:function(i){return new(i||e)},imports:[[o.c,n.q.forChild(Y),s.F.forChild(),r.d,a.a,c.a,d.a.forChild(),l.a]]}),e})()}}]);